{"version":3,"file":"data-queue.js","sourceRoot":"","sources":["data-queue.ts"],"names":[],"mappings":"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","sourcesContent":["// Inspired by https://github.com/toajs/quic/blob/master/src/stream.ts\n\n/** @private */\nexport class DataQueueEntry {\n  data: Buffer\n  next?: DataQueueEntry\n  constructor (buf: Buffer, entry?: DataQueueEntry) {\n    this.data = buf\n    this.next = entry\n  }\n}\n\n/** @private */\nexport class DataQueue {\n  head?: DataQueueEntry\n  tail?: DataQueueEntry\n  length: number\n  constructor () {\n    this.length = 0\n  }\n\n  push (buf: Buffer): void {\n    const entry = new DataQueueEntry(buf)\n\n    if (this.tail) {\n      this.tail.next = entry\n    } else {\n      this.head = entry\n    }\n    this.tail = entry\n    this.length += 1\n  }\n\n  shift () {\n    if (!this.head) {\n      return null\n    }\n    const ret = this.head.data\n    if (this.length === 1) {\n      this.head = this.tail = undefined\n    } else {\n      this.head = this.head.next\n    }\n    this.length -= 1\n    return ret\n  }\n\n  read (n: number): Buffer | undefined {\n    if (!this.head) {\n      return undefined\n    }\n\n    let bytesLeft = n\n    const chunks: Buffer[] = []\n    while (bytesLeft > 0 && this.length > 0) {\n      let chunk = this.head.data\n      if (chunk.length > bytesLeft) {\n        this.head.data = chunk.slice(bytesLeft)\n        chunk = chunk.slice(0, bytesLeft)\n        chunks.push(chunk)\n        bytesLeft -= chunk.length\n      } else {\n        this.shift()\n        chunks.push(chunk) // ret.length <= n\n        bytesLeft -= chunk.length\n      }\n    }\n\n    return Buffer.concat(chunks)\n  }\n\n  isEmpty (): boolean {\n    return this.length === 0\n  }\n\n  byteLength (): number {\n    let length = 0\n    let entry = this.head\n    while (entry) {\n      length += entry.data.length\n      entry = entry.next\n    }\n    return length\n  }\n}\n"]}